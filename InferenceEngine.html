

<!doctype html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>4.4.5. Inference Engine &#8212; SmartDFM 1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=649a27d8" />
    <link rel="stylesheet" type="text/css" href="_static/bizstyle.css?v=532c1bf3" />
    
    <script src="_static/documentation_options.js?v=f2a433a1"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="4.4.6. CATIA" href="CATIA.html" />
    <link rel="prev" title="Alternatives to GNNs" href="Alternatives%20to%20GNNs.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <!--[if lt IE 9]>
    <script src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="CATIA.html" title="4.4.6. CATIA"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="Alternatives%20to%20GNNs.html" title="Alternatives to GNNs"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">SmartDFM 1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="Developers.html" accesskey="U"><span class="section-number">4. </span>Development notes</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">4.4.5. </span>Inference Engine</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="inference-engine">
<h1><span class="section-number">4.4.5. </span>Inference Engine<a class="headerlink" href="#inference-engine" title="Link to this heading">¶</a></h1>
<p>Inference engine is is the component of SmartDFM that compares the rules against the part currently being designed. In case of SmartDFM this has two steps both driven from <cite>bd_main.py</cite>:</p>
<ol class="arabic simple">
<li><p>Execution of pre-rules:</p></li>
</ol>
<p>The functions in pre_base.py are all numbered [p1,p2,p3,….,px]. This is so these can be easily iterated throuhg. The active pre-rules are specified in the ‘active_pre’ list.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">active_pre</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">]</span>
</pre></div>
</div>
<p>The pre-rules need to be run in different order based on what information is available in the part. The mechanism for doing this is shown below. The pre-rules list is iterated through. Pre-rule is run if all required pre-requisite parameters are already available in FactBase variable that is being passed in/out. If any pre-rule has been triggered the list is iterated through again. Only once no pre-rule is triggered in cycle the information collection is deemed finished. Each pre-rule has built in features that prevent it from running more than once.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="n">d</span><span class="o">.</span><span class="n">ite</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1">#d.ite remains 0 if no change has been done to &#39;d&#39;</span>
        <span class="n">d</span><span class="o">.</span><span class="n">ite</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">active_pre</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">runtime_error</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="c1">#error handling - displays error that made SmartDFM crash in place of the report</span>
                        <span class="n">d</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">design_errors</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">runtime_error</span>
                        <span class="n">d</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">warnings</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                        <span class="n">d</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">suggested_checks</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                        <span class="n">d</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">check_issues</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                        <span class="n">d</span><span class="o">.</span><span class="n">ite</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">break</span>

                <span class="c1">#build allows for iteration throuhg pre_base.py functions</span>
                <span class="n">build_func</span> <span class="o">=</span> <span class="s2">&quot;problem = pre_base.p&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;(d)&quot;</span>

                <span class="c1">#validation error simply means pre-requisites have not been met</span>
                <span class="k">try</span><span class="p">:</span>
                        <span class="n">exec</span><span class="p">(</span><span class="n">build_func</span><span class="p">)</span>
                        <span class="n">d</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
                <span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="c1">#print(e)</span>
                        <span class="n">p</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;d.ite&quot;</span><span class="p">,</span><span class="n">d</span><span class="o">.</span><span class="n">ite</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple">
<li><p>Execution of rules:</p></li>
</ol>
<p>Active rules are again specified with a list. However, here the numbers are also used as reference to local NCC rule database.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">active_rules</span> <span class="o">=</span>  <span class="p">[</span><span class="mi">35</span><span class="p">,</span><span class="mi">36</span><span class="p">,</span><span class="mi">71</span><span class="p">,</span><span class="mi">83</span><span class="p">,</span><span class="mi">85</span><span class="p">,</span><span class="mi">86</span><span class="p">,</span><span class="mi">91</span><span class="p">,</span><span class="mi">92</span><span class="p">,</span><span class="mi">95</span><span class="p">,</span><span class="mi">128</span><span class="p">,</span><span class="mi">133</span><span class="p">,</span><span class="mi">134</span><span class="p">,</span><span class="mi">135</span><span class="p">,</span><span class="mi">130</span><span class="p">,</span><span class="mi">139</span><span class="p">,</span><span class="mi">144</span><span class="p">,</span><span class="mi">146</span><span class="p">,</span><span class="mi">151</span><span class="p">,</span><span class="mi">166</span><span class="p">,</span><span class="mi">400</span><span class="p">,</span><span class="mi">401</span><span class="p">,</span><span class="mi">402</span><span class="p">]</span>
</pre></div>
</div>
<p>Rule execution follow similar logic to pre-rules with 2 notable differences. Firstly, the rules list is only iterated through once, as execution of a rule should not affect ability of other rules to be evaluated. Secondly, additional error handling is nested, so that user is informed about rules which were not executed. However, one broken rule does not stop other rules from being executed.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Rules running only once, rule results are text, should not affect the ability of other rules to be checked.</span>
<span class="c1">#temp:</span>
<span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">runtime_error</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">active_rules</span><span class="p">:</span>
                <span class="c1">#build function to execute - functions are named according to lists</span>
                <span class="n">build_func</span> <span class="o">=</span> <span class="s2">&quot;problem = rule_base.r&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;(d)&quot;</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">build_func</span><span class="p">)</span>
                <span class="c1">#Two levels of error handling, inner loop checks for missing information.</span>
                <span class="c1">#Missing information is not technically an error, but intended method for</span>
                <span class="c1">#skipping rules that don&#39;t apply.</span>
                <span class="c1">#Outter loop error handling actually covers for code errors in individual</span>
                <span class="c1">#rules.</span>
                <span class="k">try</span><span class="p">:</span>
                                <span class="c1">#is this too brute force ?</span>
                        <span class="k">try</span><span class="p">:</span>
                                <span class="n">exec</span><span class="p">(</span><span class="n">build_func</span><span class="p">)</span>
                                <span class="n">d</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
                                <span class="c1">#print(&quot;updated, here add some iterator to check when rules triggered&quot;)</span>
                        <span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                                <span class="c1">#print(e)</span>
                                <span class="c1">#print(&quot;Rule &quot;+str(i)+&quot; not checked&quot;)</span>
                                <span class="n">stre</span> <span class="o">=</span> <span class="s2">&quot;Rule &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; not checked due to missing information.&quot;</span>
                                <span class="c1">#consider printing some part of the actual error?</span>
                                <span class="n">d</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">check_issues</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">stre</span> <span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">er</span><span class="p">:</span>
                        <span class="c1">#print(er)</span>
                        <span class="c1">#print(&quot;Rule &quot;+str(i)+&quot; not checked&quot;)</span>
                        <span class="n">stre</span> <span class="o">=</span> <span class="s2">&quot;Rule &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; not checked due to DFM tool error.&quot;</span>
                        <span class="c1">#consider printing some part of the actual error?</span>
                        <span class="n">d</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">check_issues</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">stre</span> <span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
</pre></div>
</div>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="Alternatives%20to%20GNNs.html"
                          title="previous chapter">Alternatives to GNNs</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="CATIA.html"
                          title="next chapter"><span class="section-number">4.4.6. </span>CATIA</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/InferenceEngine.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="CATIA.html" title="4.4.6. CATIA"
             >next</a> |</li>
        <li class="right" >
          <a href="Alternatives%20to%20GNNs.html" title="Alternatives to GNNs"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">SmartDFM 1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="Developers.html" ><span class="section-number">4. </span>Development notes</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">4.4.5. </span>Inference Engine</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2023, Jakub Kucera.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    </div>
  </body>
</html>